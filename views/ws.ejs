<% include header %>
        <div id="content-form">
          <div class="row-fluid">
              <div class="accordion span12" id="pane-file-select">
                <div class="accordion-group">
                  <div class="accordion-heading">
                    <a class="accordion-toggle" data-toggle="collapse" data-parent="#pane-file-select" href="#collapseFive">
                      <i id="iFive" class="icon-chevron-right"></i> Requête traduite en cURL
                    </a>
                  </div>
                  <div id="collapseFive" class="accordion-body collapse" toggle-chevron="#iFive">
                    <div class="accordion-inner">
                      <p>Copiez/collez le code suivant pour exécuter la requête avec cURL.</p>
                      <p>Modifiez le chemin des fichiers s'ils ne se trouvent pas dans le répertoire courant.
                      <br/>Vous devrez peut-être ajouter des options telles que <code>--proxy</code> ou <code>--no-buffer</code> en fonction de votre environnement.</p>
                      <textarea class="code" id="curl-request"></textarea>
                    </div>
                  </div>
                </div>
              </div>
          </div>
          <div class="row-fluid">
            <form id="form" class="form-horizontal span6" enctype="multipart/form-data">
              <div class="accordion" id="pane-file-select">
                <div class="accordion-group ninja">
                  <div class="accordion-heading">
                    <a class="accordion-toggle" data-toggle="collapse" data-parent="#pane-file-select" href="#collapseOne">
                      <i id="iOne" class="icon-chevron-right"></i> Traiter des fichiers du serveur
                    </a>
                  </div>
                  <div id="collapseOne" class="accordion-body collapse" toggle-chevron="#iOne">
                    <div id="local-files" class="accordion-inner">
                      
                    </div>
                  </div>
                </div>
                <div class="accordion-group">
                  <div class="accordion-heading">
                    <a class="accordion-toggle" data-toggle="collapse" data-parent="#pane-file-select" href="#collapseTwo">
                      <i id="iTwo" class="icon-chevron-down"></i> Traiter vos fichiers de log
                    </a>
                  </div>
                  <div id="collapseTwo" class="accordion-body collapse in" toggle-chevron="#iTwo">
                    <div class="accordion-inner">
                      <div id="classic-inputs">
                        <div class="single-input">
                          <button class="btn btn-danger btn-mini file-remove-button ninja" title="remove"><i class="icon-remove icon-white"></i></button>
                          <input class='file-input' type="file" name="file" multiple/>
                        </div>
                      </div>
                      <div id="dropbox">Glissez vos fichiers ici</div>
                    </div>
                  </div>
                </div>
              </div>
            </form> <!-- form -->
            <div class="accordion form-horizontal span6" id="pane-options">
              <div class="accordion-group">
                <div class="accordion-heading">
                  <a class="accordion-toggle" data-toggle="collapse" href="#collapseThree">
                    <i id="iThree" class="icon-chevron-right"></i> Paramètres
                  </a>
                </div>
                <div id="collapseThree" class="accordion-body collapse in" toggle-chevron="#iThree">
                  <div id="advanced-options" class="accordion-inner">
                    <div class="control-group">
                      <label class="control-label" for="advanced-options-predefined">
                        <a class="notALink" data-toggle="tooltip" title="Valeurs pré-définies">Valeurs pré-définies <i class="icon-question-sign"></i></a>
                      </label>
                      <div class="controls">
                        <select id="advanced-options-predefined" name="advanced-options-predefined">
                          <option value="" selected>Aucune</option>
                        </select>
                      </div>
                    </div>
                     <div class="control-group">
                      <label class="control-label" for="input-log-type">
                        <a class="notALink" data-toggle="tooltip" title="Plateforme d'origine des logs">Type de log <i class="icon-question-sign"></i></a>
                      </label>
                      <div class="controls">
                        <select id="input-log-type" name="input-log-type">
                          <option value="" selected>Auto</option>
                          <option value="ezproxy">EZproxy</option>
                          <option value="apache">Apache</option>
                          <option value="squid">Squid</option>
                        </select>
                      </div>
                    </div>
                    <div class="control-group">
                      <label class="control-label" for="input-log-format">
                        <a class="notALink" data-toggle="tooltip" title="Format des lignes de log, du style '%h %l %u %t %s %b'. Pour plus d'infos, consulter Formats de logs dans la documentation">Format de log <i class="icon-question-sign"></i></a>
                      </label>
                      <div class="controls">
                        <textarea id="input-log-format" name="input-log-format" row="1" disabled></textarea>
                      </div>
                    </div>
                    <div class="control-group">
                      <label class="control-label" for="input-result-format">
                        <a class="notALink" data-toggle="tooltip" title="Format du fichier en résultat">Format du résultat <i class="icon-question-sign"></i></a>
                      </label>
                      <div class="controls">
                        <select id="input-result-format" name="input-result-format">
                          <option value="text/csv" selected>CSV</option>
                          <option value="application/json">JSON</option>
                        </select>
                      </div>
                    </div>
                    <div class="control-group">
                      <label class="control-label" for="input-traces">
                        <a class="notALink" data-toggle="tooltip" title="Niveau de verbosité des traces, du moins verbeux Error au plus verbeux Silly.">Traces système <i class="icon-question-sign"></i></a>
                      </label>
                      <div class="controls">
                        <select id="input-traces" name="input-traces">
                          <option value="error">Error</option>
                          <option value="warn">Warn</option>
                          <option value="info" selected>Info</option>
                          <option value="verbose">Verbose</option>
                          <option value="silly">Silly</option>
                        </select>
                      </div>
                    </div>
                    <div class="control-group">
                      <label class="control-label" for="input-output-fields">
                        <a class="notALink" data-toggle="tooltip" title="Indiquer les champs (en-têtes) désirés pour le fichier de sortie. Exemple : -host,-login,+datetime">Champs en sortie <i class="icon-question-sign"></i></a>
                      </label>
                      <div class="controls">
                        <input id="input-output-fields" placeholder="Ex: -host,-login,+datetime" type="text" name="input-output-fields"/>
                      </div>
                    </div>
                    <div class="control-group">
                      <label class="control-label" for="input-request-charset">
                        <a class="notALink" data-toggle="tooltip" title="Jeu de caractères (charset) utilisé dans les fichiers à traiter.">Encodage en entrée <i class="icon-question-sign"></i></a>
                      </label>
                      <div class="controls">
                        <select id="input-request-charset" name="input-request-charset">
                          <option value="utf-8">UTF-8</option>
                          <option value="iso-8859-1">ISO-8859-1</option>
                        </select>
                      </div>
                    </div>
                    <div class="control-group">
                      <label class="control-label" for="input-response-charset">
                        <a class="notALink" data-toggle="tooltip" title="Jeu de caractères (charset) utilisé pour les données en sortie.">Encodage en sortie <i class="icon-question-sign"></i></a>
                      </label>
                      <div class="controls">
                        <select id="input-response-charset" name="input-response-charset">
                          <option value="utf-8">UTF-8</option>
                          <option value="iso-8859-1">ISO-8859-1</option>
                        </select>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
              <div class="accordion-group">
                <div class="accordion-heading">
                  <a class="accordion-toggle" data-toggle="collapse" href="#collapseFour">
                    <i id="iFour" class="icon-chevron-right"></i> Champ utilisateurs
                  </a>
                </div>
                <div id="collapseFour" class="accordion-body collapse" toggle-chevron="#iFour">
                  <div id="user-fields" class="accordion-inner">
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div id="nofile-warn" class="alert alert-warning ninja">Vous devez sélectionner au moins un fichier.</div>
          <div id="big-warn" class="alert alert-warning ninja">Les fichiers sélectionnés sont volumineux, le traitement peut être long.</div>
          <div class="text-center">
            <input type="submit" class="btn" value="Traiter" id="submit" />
          </div>
        </div><!-- form-content -->
        <div id="content-result" class="ninja">
          <div id="process-info" class="texte-center alert alert-info">
            Vos logs sont en cours de traitement mais vous pouvez déjà commencer à télécharger le résultat.
          </div>
          <div id="process-success" class="texte-center alert alert-success ninja">
            Le traitement de vos logs s'est terminé avec succès.
          </div>
          <div class="alert alert-error text-center ninja">
            Erreur : <span id="error"></span>
          </div>
          <div class="progress progress-striped active">
            <div class="bar" style="width: 0%;">0%</div>
          </div>
          <div id="process-btns" class="text-center">
            <a href="" target="_blank" id="get-btn" class="btn btn-primary btn-large">Télécharger le résultat en <span id='result-format'></span></a>
            <a href="" id="cancel-btn" class="btn">Annuler</a>
          </div>
          <div class="row-fluid">
            <div class="span6">
              <div id="submitted-files">
                <fieldset>
                  <legend>Fichiers traités</legend>
                  <ul></ul>
                </fieldset>
              </div>
              <div id="post-trait-comment">
                <fieldset>
                  <legend>Exploitation des résultats</legend>
                  <ul><a href="http://analogist.couperin.org/_media/see-also/ezpaarserenderv1.1.xlsm" target="_blank">
                    Utiliser un fichier de rendu Excel</a>
                  </ul>
                  <ul><a href="http://analogist.couperin.org/ezpaarse/doc/usage#visualiser-les-resultats-avec-excel" target="_blank">
                    Aide sur l'exploitation des résultats avec excel</a>
                  </ul>
                </fieldset>
              </div>
            </div>
            <div id="report" class="span6">
              <fieldset>
                <legend>État du traitement</legend>
                <table class="table table-bordered table-hover">
                  <tr><td>Lignes en entrée</td><td id="nb-lines-input" class="result-value"></td></tr>
                  <tr><td><abbr title="Évènements de Consultations">ECs</abbr> générés</td><td id="nb-ecs" class="result-value"></td></tr>
                  <tr><td>Plateformes reconnues</td><td id="platforms" class="result-value"></td></tr>
                  <tr><td>PDF</td><td id="mime-PDF" class="result-value"></td></tr>
                  <tr><td>HTML</td><td id="mime-HTML" class="result-value"></td></tr>
                  <tr>
                    <td>
                      <a class="notALink" data-toggle="tooltip" title="Le nombre de lignes rejetées pour cent lignes en entrée. A noter que les lignes ignorées (jpg, js, css ...) ne sont pas prises en compte lors de ce calcul.">Taux de filtrage <i class="icon-question-sign"></i></a>
                    </td>
                    <td id="rejection-rate" class="result-value"></td></tr>
                  <tr><td>Durée du traitement</td><td id="job-duration" class="result-value"></td></tr>
                  <tr><td>Vitesse du traitement</td><td id="process-speed" class="result-value"></td></tr>
                </table>
              </fieldset>
              <fieldset>
                <legend>Lignes de log ignorées</legend>
                <table class="table table-bordered table-hover">
                  <tr>
                    <td>
                      <a class="notALink" data-toggle="tooltip" title="Nombre de requêtes non pertinentes. Il s'agit principalement de téléchargements d'images, css ou scripts web sans rapport direct avec une ressource. Dans un log brut, ce chiffre est souvent élevé.">Lignes ignorées <i class="icon-question-sign"></i></a>
                    </td>
                    <td id="nb-lines-ignored" class="result-value"></td>
                  </tr>
                  <tr>
                    <td><a class="link-lines-duplicate-ecs" target="_blank" data-toggle="tooltip" title="Nombre de consultations ignorées car détectées comme des double-clics.">Doublons filtrés <i class="icon-question-sign"></i></a></td><td id="nb-lines-duplicate-ecs" class="result-value"></td>
                  </tr>
                  <tr>
                    <td><a class="link-lines-unordered-ecs" target="_blank" data-toggle="tooltip" title="Lignes ignorées en raison d'un mauvais ordre chronologique.">Anomalies chronologiques <i class="icon-question-sign"></i></a></td><td id="nb-lines-unordered-ecs" class="result-value"></td>
                  </tr>
                  <tr>
                    <td><a class="link-lines-ignored-domains" target="_blank">Domaines ignorés</a></td>
                    <td class="result-value">
                      <a class="link-lines-ignored-domains" target="_blank">
                        <span id="nb-lines-ignored-domains"></span>
                      </a></td>
                  </tr>
                  <tr>
                    <td><a class="link-lines-unknown-domains" target="_blank">Domaines inconnus</a></td>
                    <td class="result-value">
                      <a class="link-lines-unknown-domains" target="_blank">
                        <span id="nb-lines-unknown-domains"></span>
                      </a>
                    </td>
                  </tr>
                  <tr>
                    <td><a class="link-lines-unknown-format" target="_blank">Formats inconnus</a></td>
                    <td class="result-value">
                      <a class="link-lines-unknown-format" target="_blank">
                        <span id="nb-lines-unknown-format"></span>
                      </a>
                    </td>
                  </tr>
                  <tr>
                    <td><a class="link-lines-unqualified-ecs" target="_blank">ECs non qualifiés</a></td>
                    <td class="result-value">
                      <a class="link-lines-unqualified-ecs" target="_blank">
                        <span id="nb-lines-unqualified-ecs"></span>
                      </a>
                    </td>
                  </tr>
                  <tr>
                    <td><a class="link-lines-pkb-miss-ecs" target="_blank">PKBs manquantes</a></td>
                    <td class="result-value">
                      <a id="link-lines-pkb-miss-ecs" target="_blank">
                        <span id="nb-lines-pkb-miss-ecs"></span>
                      </a>
                    </td>
                  </tr>
                </table>
              </fieldset>
            </div>

          <div id="result-btns" class="text-center">
            <a target="_blank" id="report-btn" class="btn">Rapport détaillé</a>
            <a target="_blank" id="traces-btn" class="btn">Traces système</a>
            <a href="/" id="reset-btn" class="btn ninja">Nouveau traitement</a>
          </div>
        </div><!-- result-content -->
        <div id="navigator-alert" class="text-center ninja">
          <h2>
            Votre navigateur n'est pas compatible avec ezPAARSE.
          </h2>
          <h2>
            Nous vous conseillons d'utiliser :
          </h2>
          <div class="span2"></div>
          <div class="row-fluid">
            <div class="span3">
              <a href="http://www.google.fr/intl/fr/chrome/browser/">
                <h2>Chrome</h2>
                <img src="/img/chrome.jpg" alt="logo chrome">
              </a>
            </div>
            <div class="span1">
              <h2>ou</h2>
            </div>
            <div class="span3">
              <a href="http://www.mozilla.org/fr/firefox/new/">
                <h2>Firefox</h2>
                <img src="/img/firefox.jpg" alt="logo firefox">
              </a>
            </div>
            <div class="span3"></div>
          </div>
        </div>
        <script type="text/html" id="user-field-template">
        <div class="user-field">
          <div class="control-group">
            <label class="control-label" for="input-user-field-src">
              <a class="notALink" data-toggle="tooltip" title="Nom du champ contenant les informations à extraire">Champ source <i class="icon-question-sign"></i></a>
            </label>
            <div class="controls">
              <input class="input-user-field-src" type="text" name="input-user-field-src"/>
            </div>
          </div>
          <div class="control-group">
            <label class="control-label" for="input-user-field-sep">
              <a class="notALink" data-toggle="tooltip" title="Caractère séparant les valeurs du champ source (utilisez le mot 'space' si le séparateur est un espace)">Séparateur <i class="icon-question-sign"></i></a>
            </label>
            <div class="controls">
              <input class="input-user-field-sep" placeholder="Ex: space + , ;" type="text" name="input-user-field-sep"/>
            </div>
          </div>
          <div class="control-group">
            <label class="control-label" for="input-user-field-dest">
              <a class="notALink" data-toggle="tooltip" title="Champs dans lesquels sont stockées les valeurs extraites. Les valeurs en adéquation avec une expression régulière sont ajoutées au champ correspondant.">Champs destination <i class="icon-question-sign"></i></a>
            </label>
            <div class="controls">
              <div class="user-field-dest row-fluid">
                <div class="dest">
                  <input class="span4 input-user-field-dest-name" type="text" name="input-user-field-dest-name" placeholder="Nom"/>
                  <input class="span8 input-user-field-dest-regexp" type="text" name="input-user-field-dest-regexp" placeholder="Expression régulière"/>
                </div>
              </div>
            </div>
          </div>
          <div class="control-group">
            <label class="control-label" for="input-user-field-residual">
              <a class="notALink" data-toggle="tooltip" title="(Optionnel) Champ recevant les valeurs ne correspondant à aucune expression régulière.">Champ restes <i class="icon-question-sign"></i></a>
            </label>
            <div class="controls">
              <input class="input-user-field-residual" type="text" name="input-user-field-residual"/>
            </div>
          </div>
        </div>
        </script>
        <script type="text/html" id="dest-template">
        <div class="dest">
          <input class="span4 input-user-field-dest-name" type="text" name="input-user-field-dest-name" placeholder="Nom"/>
          <input class="span8 input-user-field-dest-regexp" type="text" name="input-user-field-dest-regexp" placeholder="Expression régulière"/>
        </div>
        </script>
<% include footer %>